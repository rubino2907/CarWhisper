<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<div class="page">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="profile"> 
      <div class="name">Ruben Costa</div>
      <div class="icons">‚öôÔ∏è</div>
    </div>

    <div class="search">
      <input placeholder="Search for chats..."/>
    </div>

    <nav class="menu">
    <button [class.active]="activeSection === 'chats'" (click)="openChats()">
      <i class="fa-solid fa-message"></i>
      Chats ({{ chats.length }})
    </button>

    <button [class.active]="activeSection === 'predictor'" (click)="openValuePredictor()">
      <i class="fa-solid fa-chart-line"></i>
      Value Predictor
    </button>
  </nav>


    <div class="pinned">
      <h4>Pinned</h4>
      <ul>
        <li>Modelo: gpt 3.5 turbo</li>
        <li>Dataset: 1.1 Milh√µes of cars ( US UK DE) </li>
      </ul>
    </div>

    <div class="history" *ngIf="!showPredictor">
      <h4>Chat History</h4>
      <ul>
        <li 
          *ngFor="let c of chats" 
          (click)="openChat(c)" 
          class="history-item">
          
          <div class="history-top">
            <span class="chat-model">{{ c.model }}</span>
            <small class="chat-date">{{ c.date }}</small>
          </div>
          <p class="last-msg">{{ c.lastMessage }}</p>
        </li>
      </ul>
    </div>

    <button class="new-chat" (click)="createNewChat()" *ngIf="!showPredictor">+ Start new chat</button>
  </aside>

  <!-- Main content -->
  <main class="content">

    <!-- Lista de chats -->
    <section class="grid" *ngIf="activeSection === 'chats' && !selectedChat">
      <article 
        class="card" 
        *ngFor="let c of chats; let i = index" 
        (click)="openChat(c)">
        
        <div class="card-head">
          <small>{{ c.date }}</small>
          <span class="badge">{{ c.model }}</span>
        </div>

        <p class="excerpt">{{ c.excerpt }}</p>

        <div class="card-foot">
          <span>üí¨ {{ c.replies }}</span>
          <button 
            class="delete-btn" 
            (click)="deleteChat(i); $event.stopPropagation()">
            üóëÔ∏è
          </button>
        </div>
      </article>
    </section>

    <!-- Chat view -->
    <section class="chat-view" *ngIf="selectedChat">
      <button (click)="closeChat()">‚Üê Back to chats</button>
      <h3>Chat com {{ selectedChat.model }}</h3>

      <div class="messages">
        <div *ngFor="let msg of chatMessages" [ngClass]="msg.from">
          <strong *ngIf="msg.from==='user'">You:</strong>
          <strong *ngIf="msg.from==='bot'">{{ selectedChat.model }}:</strong>
          {{ msg.message }}
        </div>
      </div>

      <div class="chat-input">
        <input #msgInput placeholder="Escreve a tua mensagem..." />
        <button class="send-btn" (click)="sendMessage(msgInput.value); msgInput.value=''">Enviar</button>
      </div>
    </section>

    <!-- Value Predictor step-by-step -->
    <section class="predictor-view" *ngIf="activeSection === 'predictor'">
      <h3>Value Predictor</h3>

      <div class="predictor-progress">
        Passo {{ predictorStep + 1 }} / {{ predictorSteps.length }} ‚Äî
        {{ predictorSteps[predictorStep] }}
      </div>

      <form (ngSubmit)="submitPredictor()" #predictorForm="ngForm">

        <!-- Passo 1 -->
        <div *ngIf="predictorStep === 0" class="step">
          <label>Manufacturer</label>
          <select name="manufacturer" [(ngModel)]="predictorData.manufacturer" required>
            <option value="" disabled selected>Escolhe...</option>
            <option *ngFor="let b of manufacturers" [value]="b">{{ b }}</option>
          </select>

          <label>Model</label>
          <input name="model" [(ngModel)]="predictorData.model" required />

          <label>Year</label>
          <input type="number" name="year" [(ngModel)]="predictorData.year" required min="1900" max="2099" />
        </div>

        <!-- Passo 2 -->
        <div *ngIf="predictorStep === 1" class="step">
          <label>Odometer (km)</label>
          <input type="number" name="odometer" [(ngModel)]="predictorData.odometer" />

          <label>Transmission</label>
          <select name="transmission" [(ngModel)]="predictorData.transmission">
            <option value="automatic">Automatic</option>
            <option value="manual">Manual</option>
          </select>
        </div>

        <!-- Passo 3 -->
        <div *ngIf="predictorStep === 2" class="step">
          <label>Fuel</label>
          <select name="fuel" [(ngModel)]="predictorData.fuel">
            <option value="gas">Gas</option>
            <option value="diesel">Diesel</option>
            <option value="electric">Electric</option>
          </select>

          <label>Country</label>
          <select name="country" [(ngModel)]="predictorData.country">
            <option value="" disabled selected>Escolhe...</option>
            <option *ngFor="let c of countries" [value]="c">{{ c }}</option>
          </select>
        </div>

        <!-- Passo 4 -->
        <div *ngIf="predictorStep === 3" class="step">
          <h4>Revis√£o</h4>
          <p><strong>Manufacturer:</strong> {{ predictorData.manufacturer }}</p>
          <p><strong>Model:</strong> {{ predictorData.model }}</p>
          <p><strong>Year:</strong> {{ predictorData.year }}</p>
          <p><strong>Odometer:</strong> {{ predictorData.odometer || '‚Äî' }}</p>
          <p><strong>Transmission:</strong> {{ predictorData.transmission }}</p>
          <p><strong>Fuel:</strong> {{ predictorData.fuel }}</p>
          <p><strong>Country:</strong> {{ predictorData.country }}</p>
        </div>

        <!-- Bot√µes Next / Back / Submit -->
        <div class="step-actions">
          <button type="button" (click)="prevStep()" [disabled]="predictorStep === 0">Back</button>

          <button type="button"
                  *ngIf="predictorStep < predictorSteps.length - 1"
                  (click)="nextStep()"
                  [disabled]="!predictorForm.form.valid">
            Next
          </button>

          <button type="submit" *ngIf="predictorStep === predictorSteps.length - 1" [disabled]="!predictorForm.form.valid">
            Predict
          </button>
        </div>
      </form>
    </section>
  </main>
</div>
